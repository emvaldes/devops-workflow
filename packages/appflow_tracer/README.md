# appflow_tracer.tracing - README

## Overview
The `appflow_tracer.tracing` module provides structured tracing functionality for tracking execution flow, function calls, and log events within the framework. This module ensures that all relevant actions are logged for debugging, auditing, and performance monitoring.

## Features
- **Function Call Tracing**: Monitors function executions and logs their entry and exit points.
- **Structured Logging**: Captures execution details, including timestamps, event categories, and optional JSON metadata.
- **Self-Inspection**: Logs its own execution when run as a standalone script.
- **Log Sanitization**: Redacts sensitive information before writing logs.
- **Project-Specific Tracing**: Ensures only project-related files are traced.

## Module Functions

### `trace_all(frame, event, arg) -> None`
Tracks function calls and return values within the project.

**Parameters:**
- `frame`: The current stack frame.
- `event`: The event type (`call`, `return`, etc.).
- `arg`: The function argument (if applicable).

**Usage:**
```python
import sys
sys.settrace(trace_all)
```

---
### `log_message(message: str, category: str, json_data: dict = None) -> None`
Logs structured execution data.

**Parameters:**
- `message (str)`: The log message.
- `category (str)`: The category of the log (INFO, DEBUG, ERROR, etc.).
- `json_data (dict, optional)`: Additional structured data to include in the log.

**Example:**
```python
log_message("Process started", "INFO", {"user": "admin"})
```

---
### `sanitize_token_string(line: str) -> str`
Removes sensitive data from log messages.

**Parameters:**
- `line (str)`: The log entry.

**Returns:**
- `str`: The sanitized log entry.

**Example:**
```python
entry = "user=admin password=12345"
sanitized = sanitize_token_string(entry)
print(sanitized)  # Output: "user=admin password=****"
```

---
### `is_project_file(filename: str) -> bool`
Checks if a given file belongs to the project directory.

**Parameters:**
- `filename (str)`: The path of the file.

**Returns:**
- `bool`: `True` if the file is part of the project, otherwise `False`.

**Example:**
```python
if is_project_file("/path/to/project/module.py"):
    print("Tracing allowed")
```

---
### `if __name__ == "__main__":`
Enables self-inspection, logging its execution if run as a script.

**Example:**
```bash
python -m packages.appflow_tracer.tracing
```

## Logging Format
Logs generated by this module follow a structured format:
```
[TIMESTAMP] [CATEGORY] MESSAGE | JSON_METADATA
```
Example:
```
[2025-02-16 12:00:00] [INFO] Process started | {"user": "admin"}
```

## Log Storage
All logs are stored under:
```
./logs/appflow_tracer/tracing-<timestamp>.log
```
To limit log growth, older logs are automatically pruned based on a predefined threshold.

## Usage Examples
### Basic Tracing Setup
```python
import sys
from packages.appflow_tracer.tracing import trace_all

sys.settrace(trace_all)
```

### Logging Events
```python
from packages.appflow_tracer.tracing import log_message

log_message("Task executed", "DEBUG", {"task_id": 123})
```

## Future Enhancements
- Implement more fine-grained filtering for trace events.
- Enhance log sanitization to support additional patterns.
- Introduce performance monitoring hooks for execution profiling.

## Contributors
- **Project Owner**: Eduardo Valdes
- **Maintainer**: emvaldes@hotmail.com

## License
This module is licensed under the [MIT License](../LICENSE).
